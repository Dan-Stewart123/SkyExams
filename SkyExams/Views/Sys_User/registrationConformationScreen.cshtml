
@{
    ViewBag.Title = "Registration Conformation";
    var error = ViewData["err"];
}

<h2>Registration Conformation</h2>
<p>Your registration code will be emailed to you shortly, do not close this page.</p>

<label style="color:red">@error</label>

@using (Html.BeginForm("registrationConformationScreen", "Sys_User", FormMethod.Post))
{
    <label class="col-md-4">@Html.Label("User Name:")</label>
    <input type="text" id="uName" name="uName">
    <br />
    <br />
    <label class="col-md-4">@Html.Label("Registration Code:")</label>
    <input type="text" id="code" name="code">
    <br />
    <br />
    <div id="pic">
        <table border="0" cellpadding="0" cellspacing="0">
            <tr>
                <th align="center"><u>Live Camera</u></th>
                <th align="center"><u>Captured Profile Picture</u></th>
            </tr>
            <tr>
                <td><div id="webcam"></div></td>
                <td><img id="imgCapture" /></td>
            </tr>
            <tr>
                <td align="center">
                    <input type="button" class="btn btn-info" id="btnCapture" value="Capture" />
                </td>
                <td align="center">
                    <input type="button" class="btn btn-primary" id="btnUpload" value="Upload" disabled="disabled" />
                </td>
            </tr>
        </table>
    </div>
    <label>Hint: Please remember to take a profile image.</label>
    <br />
    <br />
    <button id="check" class="btn btn-info" onclick="verifyCode()" type="button">Validate Code</button>
    <br />
    <br />
    <div id="licenceInput" style="display:none;">
        <label class="col-md-4">@Html.Label("Licence Number:")</label>
        <input type="text" id="licence" name="licence">
    </div>

    <br />
    <br />
    <div id="submitButton" style="display:none;">
        <input type="submit" class="btn btn-primary" , value="Submit" />
    </div>
}


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="~/Scripts/WebCam.js"></script>
<script>
    function verifyCode() {
        var temp = document.getElementById("code").value;
        console.log(temp);
        if (temp == '101' || temp == '102') {
            document.getElementById("licenceInput").style.display = "block";
            document.getElementById("submitButton").style.display = "block";
        }
        else {
            document.getElementById("submitButton").style.display = "block";
        }
    }// code verify

    $(function () {
        Webcam.set({
            width: 320,
            height: 240,
            image_format: 'jpeg',
            jpeg_quality: 90
        });
        Webcam.attach('#webcam');
        $("#btnCapture").click(function () {
            Webcam.snap(function (data_uri) {
                $("#imgCapture")[0].src = data_uri;
                $("#btnUpload").removeAttr("disabled");
            });
        });
        $("#btnUpload").click(function () {
            $.ajax({
                type: "POST",
                url: "/Sys_User/SaveCapture",
                data: "{data: '" + $("#imgCapture")[0].src + "*" + $("#uName").val() + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (r) { }
            });
        });
    });// camera upload

</script>

