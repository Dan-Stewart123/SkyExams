@model IEnumerable<SkyExams.Models.Sys_User>
@{
    ViewBag.Title = "viewSlots";
    var uID = ViewData["uID"];
    var time = ViewData["time"];
    var err = ViewData["err"];
}

<h2>Booking slots</h2>
<br />
<br />
<p>All slots are one hour long bookings</p>
@using (Html.BeginForm("bookSlot", "Bookings", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div style="display:none;">
        <input type="text" id="id" name="id" value="@uID">
    </div>
    <label style="color:red">@err</label>
    <br />
    <br />
    <label for="insructors">Select an Instructor:</label>
    <select id="instructors" class="instructors">
        @foreach (var item in Model)
        {
            <option value="@item.SysUser_ID">@item.FName @item.Surname</option>
        }
    </select>
    <br />
    <br />
    <label for="planes">Select a Plane:</label>
    @Html.DropDownList("planes", (IEnumerable
        <SelectListItem>)ViewBag.planes)
    <br />
    <button type="button" class="btn btn-primary" onclick="getInstructorSlots()">
        Search Slots
    </button>
    <label>Hint: Click the Search Slots button to recieve a list of available bookings for your chosen instructor.</label>
    <br />
    <br />
    <label for="FromJson">Select a Slot:</label>
    @Html.DropDownList("FromJson", new SelectList(Enumerable.Empty
        <SelectListItem>()))
    <br />
    <br />
    <input type="submit" class="btn btn-primary" , value="Submit" id="submitButton" />

}
<br />
<br />
<button type="button" class="btn btn-info" onclick="location.href='@Url.Action("bookingsScreen", "Bookings", new { id = uID })'">
    Back
</button>

<script>
    function getInstructorSlots() {
        if (document.getElementById("FromJson").length != 0) {
            document.getElementById("FromJson").innerHTML = null;
        }
        $.ajax({
            url: "/Bookings/getSlots",
            type: "GET",
            data: { instructor: $('#instructors').val() },
            contentType: "application/json; charset=utf-8",
            datatype: JSON,
            success: function (result) {
                $(result).each(function () {
                    $("#FromJson").append($("<option></option>").val(this.Slot_ID).html(this.Date_Time_String));
                });
            },
            error: function (data) { }
        });
    }

    function timer() {
        window.location.href = '/Sys_User/loginScreen';
    }
    window.oninput = setTimeout(timer, @time);
</script>


